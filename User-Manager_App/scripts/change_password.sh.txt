#!/bin/bash

# Prompt for username
echo -n "Enter username to change password: "
read username

# Prompt for new password
echo -n "Enter new password: "
read -s password
echo

# Change user password
echo "$username:$password" | sudo chpasswd

# Check if the password was changed successfully
if [ $? -eq 0 ]; then
    timestamp=$(date "+%Y-%m-%d %H:%M:%S")
    echo "$timestamp,Changed password for user $username" >> passwordreset_log.csv
    
    # Increment password reset counter
    if grep -q "$username" passwordreset_counter.csv; then
        # If the user exists in the counter file, increment the count
        awk -F, -v user="$username" '$1 == user { $2 += 1 } 1' OFS=, passwordreset_counter.csv > temp && mv temp passwordreset_counter.csv
    else
        # If the user does not exist, add to the file with a count of 1
        echo "$username,1" >> passwordreset_counter.csv
    fi
    echo "Password for user $username changed successfully."
else
    echo "Failed to change password for user $username."
fi
